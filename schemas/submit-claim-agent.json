{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SubmitClaimAgent API Contract",
  "description": "Input/output schema for the SubmitClaimAgent Lambda function",
  
  "definitions": {
    "Patient": {
      "type": "object",
      "properties": {
        "firstName": { "type": "string" },
        "lastName": { "type": "string" },
        "dateOfBirth": { "type": "string", "format": "date" },
        "gender": { "type": "string", "enum": ["M", "F", "O", "U"] },
        "address": {
          "type": "object",
          "properties": {
            "street": { "type": "string" },
            "city": { "type": "string" },
            "state": { "type": "string", "pattern": "^[A-Z]{2}$" },
            "zipCode": { "type": "string", "pattern": "^[0-9]{5}(-[0-9]{4})?$" }
          }
        }
      },
      "required": ["firstName", "lastName", "dateOfBirth"]
    },
    
    "Provider": {
      "type": "object",
      "properties": {
        "npi": { "type": "string", "pattern": "^[0-9]{10}$" },
        "name": { "type": "string" },
        "taxId": { "type": "string" },
        "address": {
          "type": "object",
          "properties": {
            "street": { "type": "string" },
            "city": { "type": "string" },
            "state": { "type": "string", "pattern": "^[A-Z]{2}$" },
            "zipCode": { "type": "string", "pattern": "^[0-9]{5}(-[0-9]{4})?$" }
          }
        }
      },
      "required": ["npi", "name"]
    },
    
    "Insurance": {
      "type": "object",
      "properties": {
        "payerId": { "type": "string" },
        "payerName": { "type": "string" },
        "memberId": { "type": "string" },
        "groupNumber": { "type": "string" },
        "planType": { "type": "string" }
      },
      "required": ["payerId", "memberId"]
    },
    
    "Service": {
      "type": "object",
      "properties": {
        "procedureCode": { "type": "string", "pattern": "^[0-9]{5}$" },
        "modifier": { "type": "string", "pattern": "^[A-Z0-9]{2}$" },
        "chargeAmount": { "type": "number", "minimum": 0 },
        "units": { "type": "integer", "minimum": 1, "default": 1 },
        "serviceDate": { "type": "string", "format": "date" },
        "placeOfService": { "type": "string", "pattern": "^[0-9]{2}$" }
      },
      "required": ["procedureCode", "chargeAmount", "serviceDate"]
    },
    
    "ValidationError": {
      "type": "object",
      "properties": {
        "field": { "type": "string" },
        "message": { "type": "string" },
        "code": { "type": "string" }
      },
      "required": ["field", "message"]
    },
    
    "ValidationResults": {
      "type": "object",
      "properties": {
        "isValid": { "type": "boolean" },
        "errors": {
          "type": "array",
          "items": { "$ref": "#/definitions/ValidationError" }
        },
        "warnings": {
          "type": "array", 
          "items": { "type": "string" }
        },
        "validatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["isValid", "errors", "warnings"]
    }
  },
  
  "input": {
    "type": "object",
    "properties": {
      "claimData": {
        "type": "object",
        "properties": {
          "claimId": { "type": "string" },
          "patientId": { "type": "string" },
          "providerId": { "type": "string" },
          "patient": { "$ref": "#/definitions/Patient" },
          "provider": { "$ref": "#/definitions/Provider" },
          "insurance": { "$ref": "#/definitions/Insurance" },
          "services": {
            "type": "array",
            "items": { "$ref": "#/definitions/Service" },
            "minItems": 1
          },
          "diagnosisCodes": {
            "type": "array",
            "items": { 
              "type": "string", 
              "pattern": "^[A-Z][0-9]{2}(\\.[0-9A-Z]{1,4})?$"
            },
            "minItems": 1
          }
        },
        "required": ["patient", "provider", "insurance", "services", "diagnosisCodes"]
      },
      "submissionMethod": { 
        "type": "string",
        "enum": ["claim_md", "direct", "test"],
        "default": "test"
      },
      "validateOnly": { 
        "type": "boolean",
        "default": false,
        "description": "If true, only validate without submitting"
      }
    },
    "required": ["claimData"]
  },
  
  "output": {
    "type": "object",
    "properties": {
      "success": { "type": "boolean" },
      "claimId": { "type": "string" },
      "validationResults": { "$ref": "#/definitions/ValidationResults" },
      "x837Generated": { "type": "boolean" },
      "submissionMethod": { "type": "string" },
      "submissionId": { "type": "string" },
      "submissionStatus": { 
        "type": "string",
        "enum": ["submitted", "validation_complete", "test_submitted", "failed"]
      },
      "clearinghouse": { "type": "string" },
      "payerId": { "type": "string" },
      "expectedResponseTime": { "type": "string" },
      "trackingUrl": { "type": "string", "format": "uri" },
      "submittedAt": { "type": "string", "format": "date-time" },
      "timestamp": { "type": "string", "format": "date-time" },
      "validateOnly": { "type": "boolean" },
      "developmentMode": { "type": "boolean" },
      "testScenario": { "type": "string" },
      "message": { "type": "string" },
      "error": { "type": "string" }
    },
    "required": ["success", "claimId", "validationResults", "timestamp"],
    "additionalProperties": false
  }
}