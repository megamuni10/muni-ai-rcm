{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ERAParserAgent API Contract",
  "description": "Input/output schema for the ERAParserAgent Lambda function",
  
  "definitions": {
    "PaymentDetail": {
      "type": "object",
      "properties": {
        "claimId": { "type": "string" },
        "paidAmount": { "type": "number", "minimum": 0 },
        "patientResponsibility": { "type": "number", "minimum": 0 },
        "paymentDate": { "type": "string", "format": "date-time" },
        "payerName": { "type": "string" },
        "checkNumber": { "type": "string" },
        "paymentMethod": { "type": "string", "enum": ["electronic", "check", "credit_card"] }
      },
      "required": ["claimId", "paidAmount", "paymentDate"]
    },
    
    "DenialDetail": {
      "type": "object",
      "properties": {
        "claimId": { "type": "string" },
        "denialReason": { "type": "string" },
        "adjustmentCodes": {
          "type": "array",
          "items": { "type": "string" }
        },
        "deniedAmount": { "type": "number", "minimum": 0 },
        "denialDate": { "type": "string", "format": "date-time" },
        "payerName": { "type": "string" },
        "appealEligible": { "type": "boolean" },
        "priority": { "type": "string", "enum": ["low", "medium", "high", "critical"] }
      },
      "required": ["claimId", "denialReason", "deniedAmount"]
    },
    
    "ClaimUpdate": {
      "type": "object",
      "properties": {
        "claimId": { "type": "string" },
        "newStatus": { "type": "string", "enum": ["paid", "denied", "partially_paid", "pending"] },
        "paidAmount": { "type": "number", "minimum": 0 },
        "paymentDate": { "type": "string", "format": "date-time" },
        "denialReason": { "type": "string" },
        "denialDate": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["claimId", "newStatus", "updatedAt"]
    },
    
    "ERASummary": {
      "type": "object",
      "properties": {
        "totalClaimsProcessed": { "type": "integer", "minimum": 0 },
        "totalPayments": { "type": "integer", "minimum": 0 },
        "totalDenials": { "type": "integer", "minimum": 0 },
        "totalPaidAmount": { "type": "number", "minimum": 0 },
        "averagePayment": { "type": "number", "minimum": 0 },
        "denialRate": { "type": "number", "minimum": 0, "maximum": 100 },
        "requiresFollowUp": { "type": "boolean" },
        "generatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["totalClaimsProcessed", "totalPayments", "totalDenials"]
    }
  },
  
  "input": {
    "type": "object",
    "properties": {
      "eraFileUrl": { 
        "type": "string", 
        "format": "uri",
        "description": "S3 URL to the 835 ERA file"
      },
      "claimIds": {
        "type": "array",
        "items": { "type": "string" },
        "description": "List of claim IDs to process"
      },
      "source": { 
        "type": "string",
        "enum": ["Claim.MD", "manual_upload", "direct_payer"],
        "description": "Source system that provided the ERA"
      },
      "developmentMode": { 
        "type": "boolean",
        "default": true,
        "description": "Whether to use mock data instead of parsing actual file"
      }
    },
    "required": ["eraFileUrl", "source"]
  },
  
  "output": {
    "type": "object",
    "properties": {
      "success": { "type": "boolean" },
      "eraFileUrl": { "type": "string" },
      "source": { "type": "string" },
      "payments": {
        "type": "array",
        "items": { "$ref": "#/definitions/PaymentDetail" }
      },
      "denials": {
        "type": "array",
        "items": { "$ref": "#/definitions/DenialDetail" }
      },
      "claimUpdates": {
        "type": "array",
        "items": { "$ref": "#/definitions/ClaimUpdate" }
      },
      "summary": { "$ref": "#/definitions/ERASummary" },
      "timestamp": { "type": "string", "format": "date-time" },
      "processedClaims": { "type": "integer", "minimum": 0 },
      "developmentMode": { "type": "boolean" },
      "error": { "type": "string" }
    },
    "required": ["success", "payments", "denials", "summary", "timestamp"],
    "additionalProperties": false
  }
}