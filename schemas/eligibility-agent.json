{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "EligibilityAgent API Contract",
  "description": "Input/output schema for the EligibilityAgent Lambda function",
  
  "definitions": {
    "InsuranceInfo": {
      "type": "object",
      "properties": {
        "payerId": { "type": "string" },
        "payerName": { "type": "string" },
        "memberId": { "type": "string" },
        "firstName": { "type": "string" },
        "lastName": { "type": "string" },
        "dateOfBirth": { "type": "string", "format": "date" }
      },
      "required": ["payerId", "memberId", "firstName", "lastName"]
    },
    
    "ProviderInfo": {
      "type": "object",
      "properties": {
        "npi": { "type": "string", "pattern": "^[0-9]{10}$" },
        "name": { "type": "string" },
        "taxId": { "type": "string" }
      },
      "required": ["npi"]
    },
    
    "DeductibleInfo": {
      "type": "object",
      "properties": {
        "individual": { "type": "number", "minimum": 0 },
        "family": { "type": "number", "minimum": 0 },
        "remaining": { "type": "number", "minimum": 0 }
      }
    },
    
    "CopayInfo": {
      "type": "object",
      "properties": {
        "officeVisit": { "type": "number", "minimum": 0 },
        "specialist": { "type": "number", "minimum": 0 },
        "emergency": { "type": "number", "minimum": 0 },
        "urgentCare": { "type": "number", "minimum": 0 }
      }
    },
    
    "OutOfPocketMax": {
      "type": "object",
      "properties": {
        "individual": { "type": "number", "minimum": 0 },
        "family": { "type": "number", "minimum": 0 },
        "remaining": { "type": "number", "minimum": 0 }
      }
    },
    
    "Recommendation": {
      "type": "object",
      "properties": {
        "type": { 
          "type": "string",
          "enum": ["prior_authorization", "patient_payment", "oop_maximum", "coverage_issue", "verification_needed"]
        },
        "message": { "type": "string" },
        "priority": { 
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        }
      },
      "required": ["type", "message", "priority"]
    },
    
    "EstimatedCost": {
      "type": "object",
      "properties": {
        "estimatedCharge": { "type": "number", "minimum": 0 },
        "patientResponsibility": { "type": "number", "minimum": 0 },
        "insurancePortion": { "type": "number", "minimum": 0 },
        "calculationMethod": { "type": "string" },
        "disclaimer": { "type": "string" }
      },
      "required": ["estimatedCharge", "patientResponsibility", "insurancePortion"]
    }
  },
  
  "input": {
    "type": "object",
    "properties": {
      "patientId": { "type": "string" },
      "insuranceInfo": { "$ref": "#/definitions/InsuranceInfo" },
      "serviceType": { 
        "type": "string",
        "enum": ["medical_care", "preventive", "specialist", "imaging", "surgery", "emergency"],
        "default": "medical_care"
      },
      "providerInfo": { "$ref": "#/definitions/ProviderInfo" },
      "developmentMode": { 
        "type": "boolean",
        "default": true,
        "description": "Whether to use mock eligibility data"
      }
    },
    "required": ["patientId", "insuranceInfo"]
  },
  
  "output": {
    "type": "object",
    "properties": {
      "success": { "type": "boolean" },
      "patientId": { "type": "string" },
      "eligibilityCheckId": { "type": "string" },
      "eligibilityStatus": { 
        "type": "string",
        "enum": ["active", "inactive", "pending", "limited", "unknown"]
      },
      "effectiveDate": { "type": "string", "format": "date" },
      "terminationDate": { "type": "string", "format": "date" },
      "planType": { "type": "string" },
      "deductible": { "$ref": "#/definitions/DeductibleInfo" },
      "copay": { "$ref": "#/definitions/CopayInfo" },
      "coinsurance": { "type": "number", "minimum": 0, "maximum": 100 },
      "outOfPocketMax": { "$ref": "#/definitions/OutOfPocketMax" },
      "authorizationRequired": { "type": "boolean" },
      "coveredServices": {
        "type": "array",
        "items": { "type": "string" }
      },
      "responseCode": { "type": "string" },
      "reason": { "type": "string" },
      "recommendations": {
        "type": "array",
        "items": { "$ref": "#/definitions/Recommendation" }
      },
      "verificationStatus": { 
        "type": "string",
        "enum": ["verified", "failed", "unknown"]
      },
      "estimatedPatientCost": { "$ref": "#/definitions/EstimatedCost" },
      "timestamp": { "type": "string", "format": "date-time" },
      "developmentMode": { "type": "boolean" },
      "error": { "type": "string" }
    },
    "required": ["success", "patientId", "eligibilityCheckId", "timestamp"],
    "additionalProperties": false
  }
}